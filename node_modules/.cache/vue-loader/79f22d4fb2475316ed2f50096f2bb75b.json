{"remainingRequest":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js??vue-loader-options!/root/ahmed/vueJs/systemfinal/src/views/users/Edit-add.vue?vue&type=style&index=0&id=5d47ee46&lang=scss&scoped=true&","dependencies":[{"path":"/root/ahmed/vueJs/systemfinal/src/views/users/Edit-add.vue","mtime":1591128735708},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmZvcm0tdGl0bGUgewogIGZvbnQtd2VpZ2h0OiA3MDA7CiAgbGluZS1oZWlnaHQ6IDMuNnJlbTsKICBmb250LXNpemU6IDIuNjRyZW07CiAgbWFyZ2luLWJvdHRvbTogNXJlbTsKICAmIGkgewogICAgZm9udC1zaXplOiAzLjZyZW07CiAgICB2ZXJ0aWNhbC1hbGlnbjogYm90dG9tOwogIH0KfQoKbGFiZWwgewogIGZvbnQtc2l6ZTogMS42cmVtICFpbXBvcnRhbnQ7Cn0KaW5wdXQsCi5jaGVja2JveCBzcGFuOm5vdCgubGV2ZXIpLAp0ZXh0YXJlYSwKc2VsZWN0IHsKICBmb250LXNpemU6IDEuNnJlbSAhaW1wb3J0YW50OwogIGhlaWdodDogNC4ycmVtICFpbXBvcnRhbnQ7Cn0KLmNoZWNrYm94IHsKICBwb3NpdGlvbjogcmVsYXRpdmU7Cn0K"},{"version":3,"sources":["Edit-add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Edit-add.vue","sourceRoot":"src/views/users","sourcesContent":["<template>\n  <div class=\"row\">\n    <Breadcrumbs :title=\"title\" :path=\"path\" :fregment=\"fregment\" />\n    <div class=\"col s12 mt-65\">\n      <div class=\"container\">\n        <!-- Current balance & total transactions cards-->\n        <div class=\"row mt-4\">\n          <div class=\"col s12 m12 l12\">\n            <!-- Current Balance -->\n            <h5 class=\"form-title\">\n              <i class=\"material-icons app-header-icon text-top\"\n                >perm_identity</i\n              >\n              {{ $t(title, { fregment }) }}\n            </h5>\n\n            <div class=\"card animated  fadeInLeft \">\n              <div class=\"card-content\">\n                <form @submit.prevent=\"submitted()\">\n                  <div class=\"card-alert danger card\" v-if=\"validationError\">\n                    <div class=\"card-content\">\n                      <p>\n                        <i class=\"material-icons\">error</i>{{ validationError }}\n                      </p>\n                    </div>\n                  </div>\n                  <div class=\"row\">\n                    <div\n                      class=\"input-field col s12\"\n                      :class=\"{ error: validation.hasError('name') }\"\n                    >\n                      <input v-model=\"name\" id=\"name\" type=\"text\" />\n                      <label for=\"name\" :class=\"name ? 'active' : ''\">{{\n                        $t(\"name\")\n                      }}</label>\n                      <div class=\"message\">\n                        {{ validation.firstError(\"name\") }}\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"row\">\n                    <div\n                      class=\"input-field col s12\"\n                      :class=\"{ error: validation.hasError('email') }\"\n                    >\n                      <input v-model=\"email\" id=\"email\" type=\"email\" />\n                      <label for=\"email\" :class=\"email ? 'active' : ''\">{{\n                        $t(\"email\")\n                      }}</label>\n                      <div class=\"message\">\n                        {{ validation.firstError(\"email\") }}\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"row\">\n                    <div\n                      class=\"input-field col s12\"\n                      :class=\"{ error: validation.hasError('password') }\"\n                    >\n                      <input v-model=\"password\" id=\"password\" type=\"password\" />\n                      <label for=\"password\">{{ $t(\"password\") }}</label>\n                      <div class=\"message\" v-if=\"user\">\n                        {{ $t(\"password_note\") }}\n                      </div>\n                      <div class=\"message\">\n                        {{ validation.firstError(\"password\") }}\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"row\" v-if=\"!user\">\n                    <div\n                      class=\"input-field col s12\"\n                      :class=\"{\n                        error: validation.hasError('passwordConfirmation')\n                      }\"\n                    >\n                      <input\n                        v-model=\"passwordConfirmation\"\n                        id=\"password_confirmation\"\n                        type=\"password\"\n                      />\n                      <label for=\"password_confirmation\">{{\n                        $t(\"password_confirmation\")\n                      }}</label>\n                      <div class=\"message\">\n                        {{ validation.firstError(\"passwordConfirmation\") }}\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"row\">\n                    <div\n                      class=\"input-field col s12\"\n                      :class=\"{ error: validation.hasError('roles') }\"\n                    >\n                      <select\n                        v-if=\"rolesLoaded\"\n                        id=\"roles\"\n                        multiple\n                        v-model=\"roles\"\n                      >\n                        <option value=\"\" disabled=\"none\">{{\n                          `Select role`\n                        }}</option>\n                        <option\n                          v-for=\"role in allRoles\"\n                          :key=\"role.id\"\n                          :value=\"role.slug\"\n                          >{{ role.name }}</option\n                        >\n                      </select>\n                      <label for=\"roles\" :class=\"roles ? 'active' : ''\">{{\n                        $t(\"roles\")\n                      }}</label>\n                      <div class=\"message\">\n                        {{ validation.firstError(\"roles\") }}\n                      </div>\n                    </div>\n                  </div>\n                  <div\n                    class=\"row\"\n                    :class=\"isPos ? '' : 'hide'\"\n                    id=\"employees_select\">\n                    <div\n                      class=\"input-field col s12\"\n                      :class=\"{ error: employeeErr }\"\n                    >\n                      <select id=\"employee\" v-model=\"employee\">\n                        <option value=\"\" disabled=\"none\">{{\n                          `Select employee`\n                        }}</option>\n                        <option\n                          v-for=\"employee in allEmployees\"\n                          :key=\"employee.id\"\n                          :value=\"employee.id\"\n                          >{{ employee.name }}</option\n                        >\n                      </select>\n                      <label for=\"employee\" :class=\"employee ? 'active' : ''\">{{\n                        $t(\"employee\")\n                      }}</label>\n                      <div class=\"message\" v-if=\"employeeErr\">\n                        {{ $t(\"required\") }}\n                      </div>\n                      <div class=\"message\">\n                        {{ $t(\"employee_note\") }}\n                        <router-link :to=\"{ name: 'employees.create' }\">{{\n                          $t(\"add_employee\")\n                        }}</router-link>\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"row\">\n                    <div class=\"input-field col s12\">\n                      <button\n                        class=\"btn create cyan waves-effect waves-light left\"\n                        type=\"submit\"\n                        name=\"action\"\n                        disabled=\"disabled\"\n                      >\n                        {{ $t(\"save\") }}\n                        <i class=\"material-icons right\">send</i>\n                      </button>\n                    </div>\n                  </div>\n                </form>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport Breadcrumbs from \"@/components/layouts/Breadcrumbs.vue\";\nimport M from \"materialize-css\";\nimport SimpleVueValidation from \"simple-vue-validator\";\nconst Validator = SimpleVueValidation.Validator;\nimport gql from \"graphql-tag\";\nexport default {\n  name: \"edit-add-users\",\n  components: {\n    Breadcrumbs\n  },\n  data() {\n    return {\n      path: [{ title: \"users\", route: \"users.index\" }],\n      user: {},\n      posRole: {},\n      name: \"\",\n      email: \"\",\n      password: \"\",\n      passwordConfirmation: \"\",\n      allRoles: [],\n      roles: [],\n      isPos: false,\n      allEmployees: [],\n      employee: null,\n      employeeErr: true,\n      title: \"create_user\",\n      validationError: \"\",\n      rolesLoaded: true,\n      fregment: \"\"\n    };\n  },\n  validators: {\n    email(value) {\n      return Validator.value(value)\n        .required()\n        .email();\n    },\n    name(value) {\n      return Validator.value(value)\n        .required()\n        .minLength(3);\n    },\n    roles(value) {\n      return Validator.value(value).required();\n    },\n    password(value) {\n      return Validator.value(value)\n        .required()\n        .minLength(6);\n    },\n    passwordConfirmation(value) {\n      return Validator.value(value)\n        .required()\n        .match(this.password);\n    },\n    employee(value) {\n      return Validator.value(value).required();\n    }\n  },\n\n  apollo: {\n    user() {\n      return {\n        query: require(\"@/graphql/queries/User.gql\"),\n        variables() {\n          return {\n            id: parseInt(this.$route.params.id)\n          };\n        }\n      };\n    },\n    allRoles() {\n      return {\n        query: gql`\n          query {\n            allRoles {\n              name\n              slug\n            }\n          }\n        `\n      };\n    },\n    allEmployees() {\n      return {\n        query: gql`\n          query {\n            allEmployees {\n              name\n              id\n            }\n          }\n        `\n      };\n    }\n  },\n\n  watch: {\n    employee: {\n      handler(value) {\n        const btn = document.querySelector(\".input-field button\");\n        if (value) {\n          this.employeeErr = false;\n        } else {\n          btn.removeAttribute(\"disabled\");\n          this.employeeErr = true;\n        }\n      }\n    },\n    user: {\n      handler(user) {\n        if (user) {\n          this.name = user.name;\n          this.email = user.email;\n          this.title = `edit`;\n          this.fregment = user.name;\n          let roles = [];\n          user.roles.forEach(role => {\n            roles.push(role.slug);\n          });\n          if (user.employee) {\n            this.isPos = true;\n            this.employee = user.employee.id;\n            const btn = document.querySelector(\".input-field button\");\n            btn.removeAttribute(\"disabled\");\n          }\n          this.roles = roles;\n          this.rolesLoaded = true;\n        }\n      }\n    },\n    \"validation.errors\"() {\n      const btn = document.querySelector(\".input-field button\");\n      if (this.validation.errors.length > 0) {\n        btn.setAttribute(\"disabled\", \"disabled\");\n      } else {\n        if (!this.user) {\n          this.validation.touchedRecords.length > 4\n            ? btn.removeAttribute(\"disabled\")\n            : \"\";\n        } else {\n          btn.removeAttribute(\"disabled\");\n        }\n      }\n    },\n    roles: {\n      handler(value) {\n        if (value) {\n          const btn = document.querySelector(\".input-field button\");\n          if (value.indexOf(\"pos\") != -1) {\n            if (!this.employee) {\n              setTimeout(() => {\n                btn.setAttribute(\"disabled\", \"disabled\");\n              }, 1000);\n            } else {\n              setTimeout(() => {\n                btn.removeAttribute(\"disabled\");\n              }, 1100);\n            }\n            this.isPos = true;\n          } else {\n            this.isPos = false;\n            setTimeout(() => {\n              btn.removeAttribute(\"disabled\");\n            }, 1100);\n          }\n        }\n      }\n    }\n  },\n  methods: {\n    submitted() {\n      this.user ? this.updateUser() : this.createUser();\n    },\n    loadSelects() {\n      let selects = document.querySelectorAll(\"select\");\n      setTimeout(() => {\n        M.FormSelect.init(selects, {});\n      }, 3000);\n    },\n    updateUser() {\n      this.$apollo\n        .mutate({\n          mutation: require(\"@/graphql/mutations/UpdateUser.gql\"),\n          // Parameters\n          variables: {\n            name: this.name,\n            email: this.email,\n            id: parseInt(this.$route.params.id),\n            password: this.password,\n            password_confirmation: this.passwordConfirmation,\n            employee: parseInt(this.employee),\n            roles: this.roles\n          }\n        })\n        .then(data => {\n          M.toast({\n            html: `${this.$t(\"updated_successfully\", {\n              name: data.data.updateUser.name\n            })}`,\n            classes: \"success toast\",\n            displayLength: 2000\n          });\n          this.user.name = this.name;\n          this.user.email = this.email;\n          this.user.employee = this.employee;\n          this.$router.push({ name: \"users.index\" });\n        })\n        .catch(() => {\n          this.validationError = this.$t(\"email_unique\");\n        });\n    },\n    createUser() {\n      this.$apollo\n        .mutate({\n          mutation: require(\"@/graphql/mutations/CreateUser.gql\"),\n          // Parameters\n          variables: {\n            name: this.name,\n            email: this.email,\n            password: this.password,\n            password_confirmation: this.passwordConfirmation,\n            employee: parseInt(this.employee),\n            roles: this.roles\n          }\n        })\n        .then(data => {\n          M.toast({\n            html: `${this.$t(\"created_successfully\", {\n              name: data.data.createUser.name\n            })}`,\n            classes: \"success toast\",\n            displayLength: 3000\n          });\n\n          this.$router.push({ name: \"users.index\" });\n        })\n        .catch(() => {\n          //console.log(e)\n          this.validationError = this.$t(\"email_unique\");\n        });\n    }\n  },\n  mounted() {\n    this.loadSelects();\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.form-title {\n  font-weight: 700;\n  line-height: 3.6rem;\n  font-size: 2.64rem;\n  margin-bottom: 5rem;\n  & i {\n    font-size: 3.6rem;\n    vertical-align: bottom;\n  }\n}\n\nlabel {\n  font-size: 1.6rem !important;\n}\ninput,\n.checkbox span:not(.lever),\ntextarea,\nselect {\n  font-size: 1.6rem !important;\n  height: 4.2rem !important;\n}\n.checkbox {\n  position: relative;\n}\n</style>\n"]}]}