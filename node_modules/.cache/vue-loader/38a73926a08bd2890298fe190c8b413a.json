{"remainingRequest":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js??vue-loader-options!/root/ahmed/vueJs/systemfinal/src/views/auth/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/root/ahmed/vueJs/systemfinal/src/views/auth/Login.vue","mtime":1591274262507},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG9uTG9naW4gfSBmcm9tICIuLi8uLi92dWUtYXBvbGxvLmpzIjsKaW1wb3J0IFNpbXBsZVZ1ZVZhbGlkYXRpb24gZnJvbSAic2ltcGxlLXZ1ZS12YWxpZGF0b3IiOwpjb25zdCBWYWxpZGF0b3IgPSBTaW1wbGVWdWVWYWxpZGF0aW9uLlZhbGlkYXRvcjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAibG9naW4iLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBlbWFpbDogIiIsCiAgICAgIHBhc3N3b3JkOiAiIiwKICAgICAgcHJldlJvdXRlOiBudWxsLAogICAgICB2YWxpZGF0aW9uRXJyb3I6ICIiCiAgICB9OwogIH0sCiAgYmVmb3JlUm91dGVFbnRlcih0bywgZnJvbSwgbmV4dCkgewogICAgbmV4dCgodm0pID0+IHsKICAgICAgdm0ucHJldlJvdXRlID0gZnJvbTsKICAgIH0pOwogIH0sCiAgdmFsaWRhdG9yczogewogICAgZW1haWw6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiBWYWxpZGF0b3IudmFsdWUodmFsdWUpCiAgICAgICAgLnJlcXVpcmVkKCkKICAgICAgICAuZW1haWwoKTsKICAgIH0sCiAgICBwYXNzd29yZDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuIFZhbGlkYXRvci52YWx1ZSh2YWx1ZSkKICAgICAgICAucmVxdWlyZWQoKQogICAgICAgIC5taW5MZW5ndGgoNik7CiAgICB9CiAgfSwKCiAgd2F0Y2g6IHsKICAgICJ2YWxpZGF0aW9uLmVycm9ycyIoKSB7CiAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5sb2dpbl9fZm9ybSAuaW5wdXQtZmllbGQgYnV0dG9uIik7CiAgICAgIHRoaXMudmFsaWRhdGlvbi5lcnJvcnMubGVuZ3RoID4gMAogICAgICAgID8gYnRuLnNldEF0dHJpYnV0ZSgiZGlzYWJsZWQiLCAiZGlzYWJsZWQiKQogICAgICAgIDogYnRuLnJlbW92ZUF0dHJpYnV0ZSgiZGlzYWJsZWQiKTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGFzeW5jIGxvZ2luKCkgewogICAgICBhd2FpdCB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiByZXF1aXJlKCJAL2dyYXBocWwvbXV0YXRpb25zL0xvZ2luLmdxbCIpLAogICAgICAgICAgLy8gUGFyYW1ldGVycwogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLmVtYWlsLAogICAgICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZAogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKGRhdGEpID0+IHsKICAgICAgICAgIHRoaXMuJGh0dHAKICAgICAgICAgICAgLnBvc3QoImh0dHA6Ly90YXNrLmVzb2x2ZS1lZy5jb20vcHVibGljL29hdXRoL3Rva2VuIiwgeyBncmFudF90eXBlIDogJ3Bhc3N3b3JkJyAsIGNsaWVudF9pZCA6IDIgLCBjbGllbnRfc2VjcmV0IDogIjNvR3BkMWhQZzM0RFdqMUQ5QVJtV1hDVjFoN01sN1lMME83b080R0siICxzY29wZToiKiIgLHVzZXJuYW1lOiB0aGlzLmVtYWlsLCBwYXNzd29yZDogdGhpcy5wYXNzd29yZCB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgbGV0IHRva2VuID0gcmVzLmRhdGFbImFjY2Vzc190b2tlbiJdOwogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ0b2tlbiIsIHRva2VuKTsKICAgICAgICAgICAgICB0aGlzLiRodHRwCiAgICAgICAgICAgICAgICAuZ2V0KCJ1c2VyL3Blcm1pc3Npb25zIiwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAudGhlbigocmVzcCkgPT4gewogICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgKICAgICAgICAgICAgICAgICAgICAicGVybWlzc29ucyIsCiAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkocmVzcC5kYXRhLnBlcm1pc3Npb25zKQogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICByZXNwLmRhdGEuYnJhbmNoCiAgICAgICAgICAgICAgICAgICAgPyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgKICAgICAgICAgICAgICAgICAgICAgICAgImJyYW5jaCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHJlc3AuZGF0YS5icmFuY2gpCiAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgOiAiIjsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICB0aGlzLiRodHRwCiAgICAgICAgICAgICAgICAuZ2V0KCJhbGxicmFuY2hlcyIpCiAgICAgICAgICAgICAgICAudGhlbigoZCkgPT4gewogICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYWxsYnJhbmNoZXMiLCBKU09OLnN0cmluZ2lmeShkLmRhdGEpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSkKICAgICAgICAgICAgCgogICAgICAgICAgb25Mb2dpbigKICAgICAgICAgICAgdGhpcy4kYXBvbGxvLnByb3ZpZGVyLmRlZmF1bHRDbGllbnQsCiAgICAgICAgICAgIGRhdGEuZGF0YS5sb2dpbi5hY2Nlc3NfdG9rZW4KICAgICAgICAgICk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy52YWxpZGF0aW9uRXJyb3IgPSB0aGlzLiR0KCJsb2dpbl9lcnJvciIpOwogICAgICAgIH0pOwogICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICB0aGlzLnByZXZSb3V0ZQogICAgICAgID8gdGhpcy4kcm91dGVyLnB1c2godGhpcy5wcmV2Um91dGUucGF0aCkKICAgICAgICA6IHRoaXMuJHJvdXRlci5wdXNoKCIvIik7CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/views/auth","sourcesContent":["<template>\n  <div class=\"login\">\n    <div class=\"login__wrapper\">\n      <div class=\"login__header\">\n        <h5>{{ $t(\"signin\") }}</h5>\n      </div>\n      <form\n        class=\"login__form\"\n        @submit.prevent=\"login\"\n        :class=\"[\n          { error: validation.hasError('email') },\n          { error: validation.hasError('password') },\n        ]\"\n      >\n        <div class=\"card-alert danger card\" v-if=\"validationError\">\n          <div class=\"card-content\">\n            <p><i class=\"material-icons\">error</i>{{ validationError }}</p>\n          </div>\n        </div>\n        <div\n          class=\"input-field col s12\"\n          :class=\"{ error: validation.hasError('email') }\"\n        >\n          <i class=\"material-icons prefix\">person_outline</i>\n          <input type=\"text\" v-model=\"email\" id=\"email\" class=\"validate\" />\n          <label class=\"active\" for=\"email\">{{ $t(\"email\") }}</label>\n          <div class=\"message\">{{ validation.firstError(\"email\") }}</div>\n        </div>\n        <div\n          class=\"input-field col s12\"\n          :class=\"{ error: validation.hasError('password') }\"\n        >\n          <i class=\"material-icons prefix\">lock_outline</i>\n          <input type=\"password\" v-model=\"password\" id=\"password\" />\n          <label for=\"password\">{{ $t(\"password\") }}</label>\n          <div class=\"message\">{{ validation.firstError(\"password\") }}</div>\n        </div>\n        <div class=\"input-field col s12\">\n          <button\n            class=\"btn cyan waves-effect waves-light border-round\"\n            type=\"submit\"\n          >\n            {{ $t(\"login\") }}\n          </button>\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n<script>\nimport { onLogin } from \"../../vue-apollo.js\";\nimport SimpleVueValidation from \"simple-vue-validator\";\nconst Validator = SimpleVueValidation.Validator;\n\nexport default {\n  name: \"login\",\n  data() {\n    return {\n      email: \"\",\n      password: \"\",\n      prevRoute: null,\n      validationError: \"\"\n    };\n  },\n  beforeRouteEnter(to, from, next) {\n    next((vm) => {\n      vm.prevRoute = from;\n    });\n  },\n  validators: {\n    email: function(value) {\n      return Validator.value(value)\n        .required()\n        .email();\n    },\n    password: function(value) {\n      return Validator.value(value)\n        .required()\n        .minLength(6);\n    }\n  },\n\n  watch: {\n    \"validation.errors\"() {\n      const btn = document.querySelector(\".login__form .input-field button\");\n      this.validation.errors.length > 0\n        ? btn.setAttribute(\"disabled\", \"disabled\")\n        : btn.removeAttribute(\"disabled\");\n    }\n  },\n  methods: {\n    async login() {\n      await this.$apollo\n        .mutate({\n          mutation: require(\"@/graphql/mutations/Login.gql\"),\n          // Parameters\n          variables: {\n            username: this.email,\n            password: this.password\n          }\n        })\n        .then((data) => {\n          this.$http\n            .post(\"http://task.esolve-eg.com/public/oauth/token\", { grant_type : 'password' , client_id : 2 , client_secret : \"3oGpd1hPg34DWj1D9ARmWXCV1h7Ml7YL0O7oO4GK\" ,scope:\"*\" ,username: this.email, password: this.password })\n            .then((res) => {\n              let token = res.data[\"access_token\"];\n              localStorage.setItem(\"token\", token);\n              this.$http\n                .get(\"user/permissions\", {\n                  headers: { Authorization: `Bearer ${token}` }\n                })\n                .then((resp) => {\n                  localStorage.setItem(\n                    \"permissons\",\n                    JSON.stringify(resp.data.permissions)\n                  );\n                  resp.data.branch\n                    ? localStorage.setItem(\n                        \"branch\",\n                        JSON.stringify(resp.data.branch)\n                      )\n                    : \"\";\n                })\n                \n              this.$http\n                .get(\"allbranches\")\n                .then((d) => {\n                  localStorage.setItem(\"allbranches\", JSON.stringify(d.data));\n                })\n                \n            })\n            \n\n          onLogin(\n            this.$apollo.provider.defaultClient,\n            data.data.login.access_token\n          );\n        })\n        .catch(() => {\n          this.validationError = this.$t(\"login_error\");\n        });\n      this.$router.go(-1);\n      this.prevRoute\n        ? this.$router.push(this.prevRoute.path)\n        : this.$router.push(\"/\");\n    }\n  }\n};\n</script>\n<style lang=\"css\" scoped>\n@import url(\"../../sass/views/auth/_login.min.css\");\n</style>\n"]}]}