{"remainingRequest":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js??vue-loader-options!/root/ahmed/vueJs/systemfinal/src/views/auth/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/root/ahmed/vueJs/systemfinal/src/views/auth/Login.vue","mtime":1591086840708},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG9uTG9naW4gfSBmcm9tICIuLi8uLi92dWUtYXBvbGxvLmpzIjsKaW1wb3J0IFNpbXBsZVZ1ZVZhbGlkYXRpb24gZnJvbSAic2ltcGxlLXZ1ZS12YWxpZGF0b3IiOwpjb25zdCBWYWxpZGF0b3IgPSBTaW1wbGVWdWVWYWxpZGF0aW9uLlZhbGlkYXRvcjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAibG9naW4iLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBlbWFpbDogIiIsCiAgICAgIHBhc3N3b3JkOiAiIiwKICAgICAgcHJldlJvdXRlOiBudWxsLAogICAgICB2YWxpZGF0aW9uRXJyb3I6ICIiCiAgICB9OwogIH0sCiAgYmVmb3JlUm91dGVFbnRlcih0bywgZnJvbSwgbmV4dCkgewogICAgbmV4dCh2bSA9PiB7CiAgICAgIHZtLnByZXZSb3V0ZSA9IGZyb207CiAgICB9KTsKICB9LAogIHZhbGlkYXRvcnM6IHsKICAgIGVtYWlsOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gVmFsaWRhdG9yLnZhbHVlKHZhbHVlKQogICAgICAgIC5yZXF1aXJlZCgpCiAgICAgICAgLmVtYWlsKCk7CiAgICB9LAogICAgcGFzc3dvcmQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiBWYWxpZGF0b3IudmFsdWUodmFsdWUpCiAgICAgICAgLnJlcXVpcmVkKCkKICAgICAgICAubWluTGVuZ3RoKDYpOwogICAgfQogIH0sCgogIHdhdGNoOiB7CiAgICAidmFsaWRhdGlvbi5lcnJvcnMiKCkgewogICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubG9naW5fX2Zvcm0gLmlucHV0LWZpZWxkIGJ1dHRvbiIpOwogICAgICB0aGlzLnZhbGlkYXRpb24uZXJyb3JzLmxlbmd0aCA+IDAKICAgICAgICA/IGJ0bi5zZXRBdHRyaWJ1dGUoImRpc2FibGVkIiwgImRpc2FibGVkIikKICAgICAgICA6IGJ0bi5yZW1vdmVBdHRyaWJ1dGUoImRpc2FibGVkIik7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBsb2dpbigpIHsKICAgICAgdGhpcy4kYXBvbGxvCiAgICAgICAgLm11dGF0ZSh7CiAgICAgICAgICBtdXRhdGlvbjogcmVxdWlyZSgiQC9ncmFwaHFsL211dGF0aW9ucy9Mb2dpbi5ncWwiKSwKICAgICAgICAgIC8vIFBhcmFtZXRlcnMKICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICB1c2VybmFtZTogdGhpcy5lbWFpbCwKICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMucGFzc3dvcmQKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgdGhpcy4kaHR0cAogICAgICAgICAgLnBvc3QoImxvZ2luIikKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgbGV0IHRva2VuID0gcmVzLmRhdGFbImFjY2Vzc190b2tlbiJdOwogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidG9rZW4iLCB0b2tlbik7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLiRodHRwCiAgICAgICAgICAuZ2V0KCJ1c2VyL3Blcm1pc3Npb25zIikKICAgICAgICAgIC50aGVuKChyZXNwKSA9PiB7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwZXJtaXNzb25zJyAsIEpTT04uc3RyaW5naWZ5KHJlc3AuZGF0YSkpCiAgICAgICAgICAgIAogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIH0pOwogICAgICAgICAgCiAgICAgICAgICBvbkxvZ2luKAogICAgICAgICAgICB0aGlzLiRhcG9sbG8ucHJvdmlkZXIuZGVmYXVsdENsaWVudCwKICAgICAgICAgICAgZGF0YS5kYXRhLmxvZ2luLmFjY2Vzc190b2tlbgogICAgICAgICAgKTsKICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YS5kYXRhLmxvZ2luLmFjY2Vzc190b2tlbikKICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgICB0aGlzLnByZXZSb3V0ZQogICAgICAgICAgICA/IHRoaXMuJHJvdXRlci5wdXNoKHRoaXMucHJldlJvdXRlLnBhdGgpCiAgICAgICAgICAgIDogdGhpcy4kcm91dGVyLnB1c2goIi8iKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLnZhbGlkYXRpb25FcnJvciA9IHRoaXMuJHQoImxvZ2luX2Vycm9yIik7CiAgICAgICAgfSk7CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/views/auth","sourcesContent":["<template>\n  <div class=\"login\">\n    <div class=\"login__wrapper\">\n      <div class=\"login__header\">\n        <h5>{{ $t(\"signin\") }}</h5>\n      </div>\n      <form\n        class=\"login__form\"\n        @submit.prevent=\"login\"\n        :class=\"[\n          { error: validation.hasError('email') },\n          { error: validation.hasError('password') }\n        ]\"\n      >\n        <div class=\"card-alert danger card\" v-if=\"validationError\">\n          <div class=\"card-content\">\n            <p><i class=\"material-icons\">error</i>{{ validationError }}</p>\n          </div>\n        </div>\n        <div\n          class=\"input-field col s12\"\n          :class=\"{ error: validation.hasError('email') }\"\n        >\n          <i class=\"material-icons prefix\">person_outline</i>\n          <input type=\"text\" v-model=\"email\" id=\"email\" class=\"validate\" />\n          <label class=\"active\" for=\"email\">{{ $t(\"email\") }}</label>\n          <div class=\"message\">{{ validation.firstError(\"email\") }}</div>\n        </div>\n        <div\n          class=\"input-field col s12\"\n          :class=\"{ error: validation.hasError('password') }\"\n        >\n          <i class=\"material-icons prefix\">lock_outline</i>\n          <input type=\"password\" v-model=\"password\" id=\"password\" />\n          <label for=\"password\">{{ $t(\"password\") }}</label>\n          <div class=\"message\">{{ validation.firstError(\"password\") }}</div>\n        </div>\n        <div class=\"input-field col s12\">\n          <button\n            class=\"btn cyan waves-effect waves-light border-round\"\n            type=\"submit\"\n          >\n            {{ $t(\"login\") }}\n          </button>\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n<script>\nimport { onLogin } from \"../../vue-apollo.js\";\nimport SimpleVueValidation from \"simple-vue-validator\";\nconst Validator = SimpleVueValidation.Validator;\n\nexport default {\n  name: \"login\",\n  data() {\n    return {\n      email: \"\",\n      password: \"\",\n      prevRoute: null,\n      validationError: \"\"\n    };\n  },\n  beforeRouteEnter(to, from, next) {\n    next(vm => {\n      vm.prevRoute = from;\n    });\n  },\n  validators: {\n    email: function(value) {\n      return Validator.value(value)\n        .required()\n        .email();\n    },\n    password: function(value) {\n      return Validator.value(value)\n        .required()\n        .minLength(6);\n    }\n  },\n\n  watch: {\n    \"validation.errors\"() {\n      const btn = document.querySelector(\".login__form .input-field button\");\n      this.validation.errors.length > 0\n        ? btn.setAttribute(\"disabled\", \"disabled\")\n        : btn.removeAttribute(\"disabled\");\n    }\n  },\n  methods: {\n    login() {\n      this.$apollo\n        .mutate({\n          mutation: require(\"@/graphql/mutations/Login.gql\"),\n          // Parameters\n          variables: {\n            username: this.email,\n            password: this.password\n          }\n        })\n        .then(data => {\n          this.$http\n          .post(\"login\")\n          .then((res) => {\n            let token = res.data[\"access_token\"];\n            localStorage.setItem(\"token\", token);\n          })\n          .catch((e) => {\n            console.log(e);\n          });\n          this.$http\n          .get(\"user/permissions\")\n          .then((resp) => {\n            localStorage.setItem('permissons' , JSON.stringify(resp.data))\n            \n          })\n          .catch((e) => {\n            console.log(e);\n          });\n          \n          onLogin(\n            this.$apollo.provider.defaultClient,\n            data.data.login.access_token\n          );\n            console.log(data.data.login.access_token)\n          this.$router.go(-1);\n          this.prevRoute\n            ? this.$router.push(this.prevRoute.path)\n            : this.$router.push(\"/\");\n        })\n        .catch(() => {\n          this.validationError = this.$t(\"login_error\");\n        });\n    }\n  }\n};\n</script>\n<style lang=\"css\" scoped>\n@import url(\"../../sass/views/auth/_login.min.css\");\n</style>\n"]}]}