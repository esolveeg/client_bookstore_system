{"remainingRequest":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js??vue-loader-options!/root/ahmed/vueJs/systemfinal/src/views/auth/Login.vue?vue&type=style&index=0&id=0e0d6e88&lang=css&scoped=true&","dependencies":[{"path":"/root/ahmed/vueJs/systemfinal/src/views/auth/Login.vue","mtime":1591274262507},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCB1cmwoIi4uLy4uL3Nhc3Mvdmlld3MvYXV0aC9fbG9naW4ubWluLmNzcyIpOwo="},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsJA","file":"Login.vue","sourceRoot":"src/views/auth","sourcesContent":["<template>\n  <div class=\"login\">\n    <div class=\"login__wrapper\">\n      <div class=\"login__header\">\n        <h5>{{ $t(\"signin\") }}</h5>\n      </div>\n      <form\n        class=\"login__form\"\n        @submit.prevent=\"login\"\n        :class=\"[\n          { error: validation.hasError('email') },\n          { error: validation.hasError('password') },\n        ]\"\n      >\n        <div class=\"card-alert danger card\" v-if=\"validationError\">\n          <div class=\"card-content\">\n            <p><i class=\"material-icons\">error</i>{{ validationError }}</p>\n          </div>\n        </div>\n        <div\n          class=\"input-field col s12\"\n          :class=\"{ error: validation.hasError('email') }\"\n        >\n          <i class=\"material-icons prefix\">person_outline</i>\n          <input type=\"text\" v-model=\"email\" id=\"email\" class=\"validate\" />\n          <label class=\"active\" for=\"email\">{{ $t(\"email\") }}</label>\n          <div class=\"message\">{{ validation.firstError(\"email\") }}</div>\n        </div>\n        <div\n          class=\"input-field col s12\"\n          :class=\"{ error: validation.hasError('password') }\"\n        >\n          <i class=\"material-icons prefix\">lock_outline</i>\n          <input type=\"password\" v-model=\"password\" id=\"password\" />\n          <label for=\"password\">{{ $t(\"password\") }}</label>\n          <div class=\"message\">{{ validation.firstError(\"password\") }}</div>\n        </div>\n        <div class=\"input-field col s12\">\n          <button\n            class=\"btn cyan waves-effect waves-light border-round\"\n            type=\"submit\"\n          >\n            {{ $t(\"login\") }}\n          </button>\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n<script>\nimport { onLogin } from \"../../vue-apollo.js\";\nimport SimpleVueValidation from \"simple-vue-validator\";\nconst Validator = SimpleVueValidation.Validator;\n\nexport default {\n  name: \"login\",\n  data() {\n    return {\n      email: \"\",\n      password: \"\",\n      prevRoute: null,\n      validationError: \"\"\n    };\n  },\n  beforeRouteEnter(to, from, next) {\n    next((vm) => {\n      vm.prevRoute = from;\n    });\n  },\n  validators: {\n    email: function(value) {\n      return Validator.value(value)\n        .required()\n        .email();\n    },\n    password: function(value) {\n      return Validator.value(value)\n        .required()\n        .minLength(6);\n    }\n  },\n\n  watch: {\n    \"validation.errors\"() {\n      const btn = document.querySelector(\".login__form .input-field button\");\n      this.validation.errors.length > 0\n        ? btn.setAttribute(\"disabled\", \"disabled\")\n        : btn.removeAttribute(\"disabled\");\n    }\n  },\n  methods: {\n    async login() {\n      await this.$apollo\n        .mutate({\n          mutation: require(\"@/graphql/mutations/Login.gql\"),\n          // Parameters\n          variables: {\n            username: this.email,\n            password: this.password\n          }\n        })\n        .then((data) => {\n          this.$http\n            .post(\"http://task.esolve-eg.com/public/oauth/token\", { grant_type : 'password' , client_id : 2 , client_secret : \"3oGpd1hPg34DWj1D9ARmWXCV1h7Ml7YL0O7oO4GK\" ,scope:\"*\" ,username: this.email, password: this.password })\n            .then((res) => {\n              let token = res.data[\"access_token\"];\n              localStorage.setItem(\"token\", token);\n              this.$http\n                .get(\"user/permissions\", {\n                  headers: { Authorization: `Bearer ${token}` }\n                })\n                .then((resp) => {\n                  localStorage.setItem(\n                    \"permissons\",\n                    JSON.stringify(resp.data.permissions)\n                  );\n                  resp.data.branch\n                    ? localStorage.setItem(\n                        \"branch\",\n                        JSON.stringify(resp.data.branch)\n                      )\n                    : \"\";\n                })\n                \n              this.$http\n                .get(\"allbranches\")\n                .then((d) => {\n                  localStorage.setItem(\"allbranches\", JSON.stringify(d.data));\n                })\n                \n            })\n            \n\n          onLogin(\n            this.$apollo.provider.defaultClient,\n            data.data.login.access_token\n          );\n        })\n        .catch(() => {\n          this.validationError = this.$t(\"login_error\");\n        });\n      this.$router.go(-1);\n      this.prevRoute\n        ? this.$router.push(this.prevRoute.path)\n        : this.$router.push(\"/\");\n    }\n  }\n};\n</script>\n<style lang=\"css\" scoped>\n@import url(\"../../sass/views/auth/_login.min.css\");\n</style>\n"]}]}