{"remainingRequest":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js??vue-loader-options!/root/ahmed/vueJs/systemfinal/src/views/auth/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/root/ahmed/vueJs/systemfinal/src/views/auth/Login.vue","mtime":1607776707263},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/ahmed/vueJs/systemfinal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG9uTG9naW4gfSBmcm9tICIuLi8uLi92dWUtYXBvbGxvLmpzIjsKaW1wb3J0IFNpbXBsZVZ1ZVZhbGlkYXRpb24gZnJvbSAic2ltcGxlLXZ1ZS12YWxpZGF0b3IiOwpjb25zdCBWYWxpZGF0b3IgPSBTaW1wbGVWdWVWYWxpZGF0aW9uLlZhbGlkYXRvcjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAibG9naW4iLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBlbWFpbDogIiIsCiAgICAgIHBhc3N3b3JkOiAiIiwKICAgICAgcHJldlJvdXRlOiBudWxsLAogICAgICB2YWxpZGF0aW9uRXJyb3I6ICIiLAogICAgfTsKICB9LAogIGJlZm9yZVJvdXRlRW50ZXIodG8sIGZyb20sIG5leHQpIHsKICAgIG5leHQoKHZtKSA9PiB7CiAgICAgIHZtLnByZXZSb3V0ZSA9IGZyb207CiAgICB9KTsKICB9LAogIHZhbGlkYXRvcnM6IHsKICAgIGVtYWlsOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gVmFsaWRhdG9yLnZhbHVlKHZhbHVlKQogICAgICAgIC5yZXF1aXJlZCgpCiAgICAgICAgLmVtYWlsKCk7CiAgICB9LAogICAgcGFzc3dvcmQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiBWYWxpZGF0b3IudmFsdWUodmFsdWUpCiAgICAgICAgLnJlcXVpcmVkKCkKICAgICAgICAubWluTGVuZ3RoKDYpOwogICAgfSwKICB9LAoKICB3YXRjaDogewogICAgInZhbGlkYXRpb24uZXJyb3JzIigpIHsKICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmxvZ2luX19mb3JtIC5pbnB1dC1maWVsZCBidXR0b24iKTsKICAgICAgdGhpcy52YWxpZGF0aW9uLmVycm9ycy5sZW5ndGggPiAwCiAgICAgICAgPyBidG4uc2V0QXR0cmlidXRlKCJkaXNhYmxlZCIsICJkaXNhYmxlZCIpCiAgICAgICAgOiBidG4ucmVtb3ZlQXR0cmlidXRlKCJkaXNhYmxlZCIpOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIGFzeW5jIGxvZ2luKCkgewogICAgICBhd2FpdCB0aGlzLiRhcG9sbG8KICAgICAgICAubXV0YXRlKHsKICAgICAgICAgIG11dGF0aW9uOiByZXF1aXJlKCJAL2dyYXBocWwvbXV0YXRpb25zL0xvZ2luLmdxbCIpLAogICAgICAgICAgLy8gUGFyYW1ldGVycwogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLmVtYWlsLAogICAgICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZCwKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigoZGF0YSkgPT4gewogICAgICAgICAgdGhpcy4kaHR0cAogICAgICAgICAgICAucG9zdCgiaHR0cDovL3N5c3RlbWFwaS5lc29sdmUtZWcuY29tL3B1YmxpYy9vYXV0aC90b2tlbiIsIHsKICAgICAgICAgICAgICBncmFudF90eXBlOiAicGFzc3dvcmQiLAogICAgICAgICAgICAgIGNsaWVudF9pZDogMiwKICAgICAgICAgICAgICBjbGllbnRfc2VjcmV0OiAiM29HcGQxaFBnMzREV2oxRDlBUm1XWENWMWg3TWw3WUwwTzdvTzRHSyIsCiAgICAgICAgICAgICAgc2NvcGU6ICIqIiwKICAgICAgICAgICAgICB1c2VybmFtZTogdGhpcy5lbWFpbCwKICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZCwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIGxldCB0b2tlbiA9IHJlcy5kYXRhWyJhY2Nlc3NfdG9rZW4iXTsKICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidG9rZW4iLCB0b2tlbik7CiAgICAgICAgICAgICAgdGhpcy4kaHR0cAogICAgICAgICAgICAgICAgLmdldCgidXNlci9wZXJtaXNzaW9ucyIsIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9LAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC50aGVuKChyZXNwKSA9PiB7CiAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKAogICAgICAgICAgICAgICAgICAgICJwZXJtaXNzb25zIiwKICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShyZXNwLmRhdGEucGVybWlzc2lvbnMpLAogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICByZXNwLmRhdGEuYnJhbmNoCiAgICAgICAgICAgICAgICAgICAgPyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgKICAgICAgICAgICAgICAgICAgICAgICAgImJyYW5jaCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHJlc3AuZGF0YS5icmFuY2gpLAogICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIDogIiI7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgdGhpcy4kaHR0cC5nZXQoImFsbGJyYW5jaGVzIikudGhlbigoZCkgPT4gewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImFsbGJyYW5jaGVzIiwgSlNPTi5zdHJpbmdpZnkoZC5kYXRhKSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIG9uTG9naW4oCiAgICAgICAgICAgIHRoaXMuJGFwb2xsby5wcm92aWRlci5kZWZhdWx0Q2xpZW50LAogICAgICAgICAgICBkYXRhLmRhdGEubG9naW4uYWNjZXNzX3Rva2VuLAogICAgICAgICAgKTsKCiAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOwogICAgICAgICAgdGhpcy5wcmV2Um91dGUKICAgICAgICAgICAgPyB0aGlzLiRyb3V0ZXIucHVzaCh0aGlzLnByZXZSb3V0ZS5wYXRoKQogICAgICAgICAgICA6IHRoaXMuJHJvdXRlci5wdXNoKCIvIik7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy52YWxpZGF0aW9uRXJyb3IgPSB0aGlzLiR0KCJsb2dpbl9lcnJvciIpOwogICAgICAgIH0pOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/views/auth","sourcesContent":["<template>\n  <div class=\"login\">\n    <div class=\"login__wrapper\">\n      <div class=\"login__header\">\n        <h5>{{ $t(\"signin\") }}</h5>\n      </div>\n      <form\n        class=\"login__form\"\n        @submit.prevent=\"login\"\n        :class=\"[\n          { error: validation.hasError('email') },\n          { error: validation.hasError('password') },\n        ]\"\n      >\n        <div class=\"card-alert danger card\" v-if=\"validationError\">\n          <div class=\"card-content\">\n            <p><i class=\"material-icons\">error</i>{{ validationError }}</p>\n          </div>\n        </div>\n        <div\n          class=\"input-field col s12\"\n          :class=\"{ error: validation.hasError('email') }\"\n        >\n          <i class=\"material-icons prefix\">person_outline</i>\n          <input type=\"text\" v-model=\"email\" id=\"email\" class=\"validate\" />\n          <label class=\"active\" for=\"email\">{{ $t(\"email\") }}</label>\n          <div class=\"message\">{{ validation.firstError(\"email\") }}</div>\n        </div>\n        <div\n          class=\"input-field col s12\"\n          :class=\"{ error: validation.hasError('password') }\"\n        >\n          <i class=\"material-icons prefix\">lock_outline</i>\n          <input type=\"password\" v-model=\"password\" id=\"password\" />\n          <label for=\"password\">{{ $t(\"password\") }}</label>\n          <div class=\"message\">{{ validation.firstError(\"password\") }}</div>\n        </div>\n        <div class=\"input-field col s12\">\n          <button\n            class=\"btn cyan waves-effect waves-light border-round\"\n            type=\"submit\"\n          >\n            {{ $t(\"login\") }}\n          </button>\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n<script>\nimport { onLogin } from \"../../vue-apollo.js\";\nimport SimpleVueValidation from \"simple-vue-validator\";\nconst Validator = SimpleVueValidation.Validator;\n\nexport default {\n  name: \"login\",\n  data() {\n    return {\n      email: \"\",\n      password: \"\",\n      prevRoute: null,\n      validationError: \"\",\n    };\n  },\n  beforeRouteEnter(to, from, next) {\n    next((vm) => {\n      vm.prevRoute = from;\n    });\n  },\n  validators: {\n    email: function(value) {\n      return Validator.value(value)\n        .required()\n        .email();\n    },\n    password: function(value) {\n      return Validator.value(value)\n        .required()\n        .minLength(6);\n    },\n  },\n\n  watch: {\n    \"validation.errors\"() {\n      const btn = document.querySelector(\".login__form .input-field button\");\n      this.validation.errors.length > 0\n        ? btn.setAttribute(\"disabled\", \"disabled\")\n        : btn.removeAttribute(\"disabled\");\n    },\n  },\n  methods: {\n    async login() {\n      await this.$apollo\n        .mutate({\n          mutation: require(\"@/graphql/mutations/Login.gql\"),\n          // Parameters\n          variables: {\n            username: this.email,\n            password: this.password,\n          },\n        })\n        .then((data) => {\n          this.$http\n            .post(\"http://systemapi.esolve-eg.com/public/oauth/token\", {\n              grant_type: \"password\",\n              client_id: 2,\n              client_secret: \"3oGpd1hPg34DWj1D9ARmWXCV1h7Ml7YL0O7oO4GK\",\n              scope: \"*\",\n              username: this.email,\n              password: this.password,\n            })\n            .then((res) => {\n              let token = res.data[\"access_token\"];\n              localStorage.setItem(\"token\", token);\n              this.$http\n                .get(\"user/permissions\", {\n                  headers: { Authorization: `Bearer ${token}` },\n                })\n                .then((resp) => {\n                  localStorage.setItem(\n                    \"permissons\",\n                    JSON.stringify(resp.data.permissions),\n                  );\n                  resp.data.branch\n                    ? localStorage.setItem(\n                        \"branch\",\n                        JSON.stringify(resp.data.branch),\n                      )\n                    : \"\";\n                });\n\n              this.$http.get(\"allbranches\").then((d) => {\n                localStorage.setItem(\"allbranches\", JSON.stringify(d.data));\n              });\n            });\n\n          onLogin(\n            this.$apollo.provider.defaultClient,\n            data.data.login.access_token,\n          );\n\n          this.$router.go(-1);\n          this.prevRoute\n            ? this.$router.push(this.prevRoute.path)\n            : this.$router.push(\"/\");\n        })\n        .catch(() => {\n          this.validationError = this.$t(\"login_error\");\n        });\n    },\n  },\n};\n</script>\n<style lang=\"css\" scoped>\n@import url(\"../../sass/views/auth/_login.min.css\");\n</style>\n"]}]}